<!-- .aside -->
<aside class="bg-light lter b-r aside-md hidden-print hidden-xs" id="nav">          
  <section class="vbox">
    <header class="header bg-primary lter text-center clearfix">
      <div class="btn-group">
        <button type="button" class="btn btn-sm btn-dark btn-icon" title="Nuevo Comprobante" data-toggle="modal" data-target="#uploadModal"><i class="fa fa-plus"></i></button> 
        <div class="btn-group hidden-nav-xs">
			<a class="btn btn-sm btn-primary" data-toggle="modal" data-target="#uploadModal" name="commit">Subir Comprobante(s)</a>
        </div>
      </div>
    </header>
    <section class="w-f scrollable">
      <div class="slim-scroll" data-height="auto" data-disable-fade-out="true" data-distance="0" data-size="5px" data-color="#333333">
        
        <!-- nav -->
        <nav class="nav-primary hidden-xs">
          <ul class="nav">
            <li >
              <a href="<%= authenticated_root_url %>">
                <i class="fa fa-dashboard icon">
                  <b class="bg-danger"></b>
                </i>
                <span>Dashboard</span>
              </a>
            </li>
            <li >
              <a href="#">
                <i class="fa fa-arrow-up icon">
                  <b class="bg-warning"></b>
                </i>
                <span class="pull-right">
                  <i class="fa fa-angle-down text"></i>
                  <i class="fa fa-angle-up text-active"></i>
                </span>
                <span>Emitidos</span>
              </a>
              <ul class="nav lt">
                <li >
                  <a href="<%= emitidos_url %>" >                                                        
                    <i class="fa fa-angle-right"></i>
                    <span>Todos</span>
                  </a>
                </li>
              </ul>
            </li>
            <li >
              <a href="#"  >
                <i class="fa fa-arrow-down icon">
                  <b class="bg-success"></b>
                </i>
                <span class="pull-right">
                  <i class="fa fa-angle-down text"></i>
                  <i class="fa fa-angle-up text-active"></i>
                </span>
                <span>Recibidos</span>
              </a>
              <ul class="nav lt">
                <li >
                  <a href="<%= recibidos_url %>" >                                                        
                    <i class="fa fa-angle-right"></i>
                    <span>Todos</span>
                  </a>
                </li>
              </ul>
            <li>
              <a href="<%= otros_url %>"  >
                <i class="fa fa-exclamation icon">
                  <b class="bg-info"></b>
                </i>
                <span>Otros</span>
              </a>
            </li>    
            <li>
              <a href="#pages"  >
                <i class="fa fa-tags icon">
                  <b class="bg-primary"></b>
                </i>
                <span class="pull-right">
                  <i class="fa fa-angle-down text"></i>
                  <i class="fa fa-angle-up text-active"></i>
                </span>
                <span>Etiquetas</span>
              </a>
              <ul class="nav lt">
                <%  (current_user.owned_tags.order(taggings_count: :desc).limit 10).each do |tag| %>
	                <li >
	                    <%= link_to raw('<i class="fa fa-angle-right"></i>'+tag.name), tags_path(:tags => tag.name) %>
	                </li>
				<% end %>
              </ul>
            </li>
            <li>
              <a href="<%= alertas_url %>"  >
                <b class="badge bg-danger pull-right"><%= @unreads_count %></b>
                <i class="fa fa-bell icon">
                  <b class="bg-primary dker"></b>
                </i>
                <span>Alertas</span>
              </a>
            </li>
            
            <li >
              <a href="#subir">
                <i class="fa fa-cloud-upload icon">
                  <b class="bg-dark"></b>
                </i>
                <span class="pull-right">
                  <i class="fa fa-angle-down text"></i>
                  <i class="fa fa-angle-up text-active"></i>
                </span>
                <span>Cargar</span>
              </a>
              <ul class="nav lt">
				<li>
					<strong>Drag & Drop</strong>
					<div class="dropfile visible-lg" id="nuevo_comprobanteOLD">
						<small>Arrastre un Comprobante para Cargar</small>
					</div>
				</li>
				<hr>
				<li>
					<strong>O Seleccione un Archivo</strong>
					<%= form_for(Comprobante.new, :url => upload_comprobante_path, :html => {:multipart => true, :class => 'bs-example form-horizontal', :id => 'new_comprobante'} ) do |f| %>
					  <%= f.file_field :comprobante %>
					  <%= f.submit 'Cargar', {:class => 'btn btn-sm btn-primary'} %>
					<% end %>
				</li>
			</ul>
		</li>
          </ul>
        </nav>
        <!-- / nav -->
      </div>
    </section>
    
    <footer class="footer lt hidden-xs b-t b-light">
      <div id="invite" class="dropup">                
        <section class="dropdown-menu on aside-md m-l-n">
          <section class="panel bg-white">
            <header class="panel-heading b-b b-light">
              SoyReceptor <i class="fa fa-circle text-success"></i>
            </header>
            <div class="panel-body animated fadeInRight">
              <p class="text-sm">Un servicio de Piloto Automatico, S.A. de C.V.</p>
              <p><a href="#" class="btn btn-sm btn-dark">Sitio Web Piloto Automatico</a></p>
            </div>
          </section>
        </section>
      </div>
      <a href="#nav" data-toggle="class:nav-xs" class="pull-right btn btn-sm btn-default btn-icon">
        <i class="fa fa-angle-left text"></i>
        <i class="fa fa-angle-right text-active"></i>
      </a>
      <div class="btn-group hidden-nav-xs">
        <button type="button" title="Contacts" class="btn btn-icon btn-sm btn-default" data-toggle="dropdown" data-target="#invite"><i class="fa fa-question"></i></button>
      </div>
    </footer>
	
  </section>
</aside>
<% content_for :specific_js do %>
	
	<script type="text/javascript" charset="utf-8">
		
		var nuevo_comprobante = document.getElementById("nuevo_comprobante");
		var nuevo_oldstyle = document.getElementById("files");
		
		// nuevo_drop function
		nuevo_drop = function(evt) {   
		    evt.stopPropagation();
		    evt.preventDefault();
			
			//$('#nuevo_comprobante').append('<br /><i class="fa fa-spinner fa fa-spin fa fa-2x"></i>');
      if($('.nuevo_drop').length>0){
        $(".nuevo_drop").remove(); // to avoid never finish progress bar
      }	
      for (a = 0; a < evt.dataTransfer.files.length; ++a){
				
				var file = evt.dataTransfer.files[a];
				//console.log(file);
        var progress = 'nuevo_drop_progress' + a;
        var label = 'nuevo_drop_label' + a;
				var formData = new FormData();
	 			formData.append('file', file);
				
	 			// upload File
	 			var xhr = new XMLHttpRequest();
	 			xhr.open('POST', '<%= upload_comprobante_url %>');
	 			xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))
        xhr.onloadstart = function() {
					$("#nuevo_comprobante").append("<div class='progress nuevo_drop'><div id="+progress+" class='progress-bar' role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100'><span class='label bg-info' id="+label+">"+file.name+"</span></div></div>");
        }
        
        (function(xhr,progress) { 
          xhr.upload.onprogress = function(e) 
          {
            current_progress = parseInt((e.loaded/e.total)*100);
            $('#' + progress).attr('aria-valuenow', e.loaded);
            $('#' + progress).attr('aria-valuemax', e.total);
            $('#' + progress).attr('style', 'width:'+current_progress);
          };
        }(xhr,progress));
	 			
        (function(xhr,file,progress,label){
        xhr.onload = function () {
          $('#' + progress).attr('aria-valuenow', xhr.upload.onprogress);
          $('#' + label).removeClass('bg-info');
	 			  if (xhr.status === 200) {
            $("#"+progress).attr('style', 'width:100%');
            $("#"+progress).addClass('progress-bar-success');
					  $('#'+label).addClass('bg-success').append(" Cargado");
	 				  //alert('Comprobante Cargado Con Exito!');
	 			  } else {
            $("#"+progress).addClass('progress-bar-danger');
					  $('#'+label).addClass('bg-danger').append(" ERROR");
	 			    //alert('Error al Cargar Comprobante, Favor de Intentar Nuevamente.');
	 			  }
	 			}
        }(xhr,file,progress,label));
	
	 			xhr.send(formData);
				
	 		  }
			  
			  $('#nuevo_comprobante .fa').first().remove();
			  
			}
		  // /.nuevo_drop function
		  
		  // nuevo_oldstyle function
		  nuevo_old = function(evt){
  		    evt.stopPropagation();
  		    evt.preventDefault();
			
			//$('#nuevo_comprobante').append('<br /><i class="fa fa-spinner fa fa-spin fa fa-2x"></i>');
      if ($(".nuevo_old").length>0){
        $(".nuevo_old").remove(); //to avoid never-ending progress bar
      }
			for (a = 0; a < evt.target.files.length; ++a){
				
				var file = evt.target.files[a];
				var formData = new FormData();
	 			formData.append('file', file);
				
	 			// upload File
	 			var xhr = new XMLHttpRequest();
        var progress = 'nuevo_old_progress' + a;
	 			var label = 'nuevo_old_label' + a;
        xhr.open('POST', '<%= upload_comprobante_url %>');
	 			xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))

        xhr.onloadstart = function() {
					$("#nuevo_comprobante").append("<div class='progress nuevo_old'><div id="+progress+" class='progress-bar' role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100'><span class='label bg-info' id="+label+">"+file.name+"</span></div></div>");
        }
        
        (function(xhr,progress) { 
          xhr.upload.onprogress = function(e) 
          {
            current_progress = parseInt((e.loaded/e.total)*100);
            $('#' + progress).attr('aria-valuenow', e.loaded);
            $('#' + progress).attr('aria-valuemax', e.total);
            $('#' + progress).attr('style', 'width:'+current_progress);
          };
        }(xhr,progress));
	 			
        (function(xhr,file,progress,label){
        xhr.onload = function () {
          $('#' + progress).attr('aria-valuenow', xhr.upload.onprogress);
          $('#'+label).removeClass('bg-info');
	 			  if (xhr.status === 200) {
            $("#"+progress).attr('style', 'width:100%');
            $("#"+progress).addClass('progress-bar-success');
					  $('#'+label).addClass('bg-success').append(" Cargado");
	 				  //alert('Comprobante Cargado Con Exito!');
	 			  } else {
            $("#"+progress).addClass('progress-bar-danger');
					  $('#'+label).addClass('bg-danger').append(" ERROR");
	 			    //alert('Error al Cargar Comprobante, Favor de Intentar Nuevamente.');
	 			  }
	 			}
        }(xhr,file,progress,label));
	
	 			xhr.send(formData);
				
			}
			
			$('#nuevo_comprobante .fa').first().remove();
			
		  }
		  // /.nuevo_oldstyle function
		  
		nuevo_comprobante.addEventListener("drop", nuevo_drop, false);
		nuevo_oldstyle.addEventListener("change", nuevo_old, false);
		
	</script>
	
<% end %>
<!-- /.aside -->
