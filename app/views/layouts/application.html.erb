<!DOCTYPE html>
<html lang="es" class="app">
<head>
  <meta charset="utf-8" />
  <title><%= content_for?(:title) ? yield(:title) : "SoyReceptor" %></title>
  <meta name="description" content="<%= content_for?(:description) ? yield(:description) : "SoyReceptor" %>">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
  <%= stylesheet_link_tag 'application', media: 'all' %>
  <%= yield :specific_css %>
  <%= csrf_meta_tags %>
</head>
  
  <body class="">
	  <section class="vbox">
		  <%= render 'layouts/navigation' %>
	      <section>
	        <section class="hbox stretch">
	          
			  <%= render 'layouts/aside' %>
			  
			  <section id="content">
			    <section class="vbox">          
			      <section class="scrollable padder"> <!-- wrapper -->
					<%= yield :breadcrumbs %>
					<%= render 'layouts/flash_messages' %>
					
					<!-- .yield -->
			  		<%= yield %>
					<!-- /.yield -->
					
				  </section>
				</section>
				<a href="#" class="hide nav-off-screen-block" data-toggle="class:nav-off-screen" data-target="#nav"></a>
			  </section>
			  
	        <aside class="bg-light lter b-l aside-md hide" id="notes">
	          <div class="wrapper">Notification</div>
	        </aside>
	      </section>
	    </section>
	  </section>
	<%= javascript_include_tag 'application' %>
	<%= yield :specific_js %>
  <script type='text/javascript'>
   $(function(){

  var sent_invoices = <%= raw @sent_invoices %>;
  var rec_invoices = <%= raw @rec_invoices %>;
  
  var sent_amount = <%= raw @sent_amount %>;
  var rec_amount = <%= raw @rec_amount %>;
  
  if(rec_invoices.length>0) {
    $("#flot-chart-1").length && $.plot($("#flot-chart-1"), [{
          data: rec_invoices,
          label: "Received Invoices"
      }, {
          data: sent_invoices,
          label: "Sent Invoices"
      }], 
      {
        series: {
            lines: {
                show: true,
                lineWidth: 1,
                fill: false,
                fillColor: {
                    colors: [{
                        opacity: 0.2
                    }, {
                        opacity: 0.1
                    }]
                }
            },
            points: {
                show: true
            },
            shadowSize: 2
        },
        grid: {
            hoverable: true,
            clickable: true,
            tickColor: "#f0f0f0",
            borderWidth: 0
        },
        colors: ["#dddddd","#89cb4e"],
        xaxis: {
            ticks: 15,
            tickDecimals: 0
        },
        yaxis: {
            ticks: 10,
            tickDecimals: 0
        },
        tooltip: true,
        tooltipOpts: {
          content: "%y",
          defaultTheme: false
        }
      }
    );
  }

  if(rec_amount.length>0){
    $("#flot-chart-2").length && $.plot($("#flot-chart-2"), [{
          data: rec_amount,
          label: "Received Amount"
      }, {
          data: sent_amount,
          label: "Sent Amount"
      }], 
      {
        series: {
            lines: {
                show: true,
                lineWidth: 1,
                fill: false,
                fillColor: {
                    colors: [{
                        opacity: 0.2
                    }, {
                        opacity: 0.1
                    }]
                }
            },
            points: {
                show: true
            },
            shadowSize: 2
        },
        grid: {
            hoverable: true,
            clickable: true,
            tickColor: "#f0f0f0",
            borderWidth: 0
        },
        colors: ["#dddddd","#89cb4e"],
        xaxis: {
            ticks: 15,
            tickDecimals: 0
        },
        yaxis: {
            ticks: 10,
            tickDecimals: 0
        },
        tooltip: true,
        tooltipOpts: {
            content: function(label, xval, yval) {
              var content = yval.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
              return content;
            },
            defaultTheme: false
        }
      }
    );
  }

  // bar
  var top_10_clients = <%= raw @top_10_clients %>;
  var client_x_axis = [];
  var client_data = [];
  $.map(top_10_clients,function(val,i) {
    ind = parseInt((i+1)*5);
    company_name = val[0];
    client_x_axis.push([ind,company_name]);
    client_data.push([ind,val[1]]);
  });
  
  var top_10_suppliers = <%= raw @top_10_suppliers %>;
  var supplier_x_axis = [];
  var supplier_data = [];
  $.map(top_10_suppliers,function(val,i) {
    ind = parseInt((i+1)*5);
    company_name = val[0];
    supplier_x_axis.push([ind,company_name]);
    supplier_data.push([ind,val[1]]);
  });
  
  var data1 = [
    {
        label: "Top 10 clients of the year",
        data: client_data,
        bars: {
            show: true,
            fill: true,
            lineWidth: 1,
            order: 1,
            fillColor:  "#6783b7"
        },
        color: "#6783b7"
    }
  ];
  
  var data2 = [
    {
        label: "Top 10 suppliers of the year",
        data: supplier_data,
        bars: {
            show: true,
            fill: true,
            lineWidth: 1,
            order: 1,
            fillColor:  "#6783b7"
        },
        color: "#6783b7"
    }
  ];

  if(client_data.length>0){
    $("#client-bar").length && $.plot($("#client-bar"), data1, {
      xaxis: {
         ticks: client_x_axis
      },
      yaxis: {
          
      },
      grid: {
          hoverable: true,
          clickable: false,
          borderWidth: 0
      },
      legend: {
          labelBoxBorderColor: "none",
          position: "left"
      },
      series: {
          shadowSize: 1
      },
      tooltip: true,
      tooltipOpts: {
          content: function(label, xval, yval) {
            var content = yval.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
            return content;
          },
          defaultTheme: false
      }
    });
  }

  if(supplier_data.length>0){
    $("#supplier-bar").length && $.plot($("#supplier-bar"), data2, {
      xaxis: {
         ticks: supplier_x_axis 
      },
      yaxis: {
          
      },
      grid: {
          hoverable: true,
          clickable: false,
          borderWidth: 0
      },
      legend: {
          labelBoxBorderColor: "none",
          position: "left"
      },
      series: {
          shadowSize: 1
      },
      tooltip: true,
      tooltipOpts: {
          content: function(label, xval, yval) {
            var content = yval.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
            return content;
          },
          defaultTheme: false
      }
    });
  }

});

  </script>
     <% if @plan.present? and @plan.price>0 %>
        <script type="text/javascript" src="https://conektaapi.s3.amazonaws.com/v0.3.2/js/conekta.js"></script>
        <script type="text/javascript">
            // Conekta Public Key
            Conekta.setPublishableKey('key_E3SBoGDap3183gtzjwXxPGQ');
            
            $(function(){
              $("#new_user").submit(function(event) {
                event.preventDefault();
                var $form;
                $form = $(this);
                /* Prevent the button from submitting multiple times */
                $form.find("button").prop("disabled", true);
                console.log('test');
                Conekta.token.create($form, conektaSuccessResponseHandler, conektaErrorResponseHandler);
                /* Prevent form information from being sent to the server */
                return false;
              });
            }); 

            var conektaSuccessResponseHandler;
            conektaSuccessResponseHandler = function(token) {
              var $form;
              $form = $("#new_user");
              /* Insert the token_id into the form so it gets submitted to the server */
              console.log(token);
              $form.append($("<input type=\"hidden\" name=\"user[conektaTokenId]\" />").val(token.id));
              $form.get(0).submit();
            };

            var conektaErrorResponseHandler;
            conektaErrorResponseHandler = function(response) {
              var $form;
              $form = $("#new_user");
              $form.find(".card-errors").text(response.message);
              $form.find("button").prop("disabled", false);
            };
            // ...
        </script>
    <% end %>
 </body>
  
</html>
